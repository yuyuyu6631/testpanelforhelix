# 智能接口自动化测试平台 V5.0 接口文档

## 1. 简介
本文档描述了 Helix AutoTest V5.0 平台的后端 API 接口。
V5.0 引入了**接口定义中心 (Interface Templates)**，实现配置与执行的解耦。

- **Base URL**: `http://localhost:8000`
- **版本**: V5.0

## 2. 接口列表

### 2.0 接口定义模板 (Templates) [NEW]

#### 获取模板列表
- **URL**: `/templates`
- **Method**: `GET`
- **Query Params**: `skip`, `limit`

#### 获取模板详情
- **URL**: `/templates/{template_id}`
- **Method**: `GET`

#### 创建模板
- **URL**: `/templates`
- **Method**: `POST`
- **Body**:
```json
{
  "code": "order_create_v1",
  "name": "Create Order",
  "base_url": "https://api.example.com",
  "method": "POST",
  "endpoint": "/orders",
  "body_type": "json",
  "body_template": "{\"sku\": \"{{sku}}\"}"
}
```

#### 更新模板
- **URL**: `/templates/{template_id}`
- **Method**: `PUT`

#### 删除模板
- **URL**: `/templates/{template_id}`
- **Method**: `DELETE`

#### 调试/预览 (Debug)
- **URL**: `/templates/debug`
- **Method**: `POST`
- **Body**:
```json
{
  "template": { ...template_object... },
  "variables": { "sku": "12345" }
}
```
- **Response**:
```json
{
  "request": { "url": "...", "body": "..." },
  "response": { "status_code": 200, "json": {...} }
}
```

### 2.1 系统配置 (Config)

#### 获取当前配置
- **URL**: `/config`
- **Method**: `GET`
- **Response**:
```json
{
  "user_token": "eyJhb...",
  "max_workers": 5,
  "headers": {}
}
```

#### 更新配置
- **URL**: `/config`
- **Method**: `POST`
- **Body**:
```json
{
  "user_token": "new_token",
  "max_workers": 10
}
```

### 2.2 用例管理 (Cases)

#### 获取用例列表
- **URL**: `/cases`
- **Method**: `GET`
- **Query Params**:
  - `skip`: 偏移量 (默认 0)
  - `limit`: 数量 (默认 100)

#### 创建用例
- **URL**: `/cases`
- **Method**: `POST`
- **Body**:
```json
{
  "question": "查询用户列表",
  "expected_keywords": "select, users",
  "is_active": true
}
```

#### 更新用例 (全量)
- **URL**: `/cases/{case_id}`
- **Method**: `PUT`

#### 更新用例 (部分)
- **URL**: `/cases/{case_id}`
- **Method**: `PATCH`

#### 删除单个用例
- **URL**: `/cases/{case_id}`
- **Method**: `DELETE`

#### 批量删除用例
- **URL**: `/cases/batch`
- **Method**: `DELETE`
- **Body**: `[1, 2, 3]`

#### 清空所有用例
- **URL**: `/cases/clear-all`
- **Method**: `DELETE`

#### 批量状态更新
- **URL**: `/cases/batch-status`
- **Method**: `POST`
- **Body**:
```json
{
  "case_ids": [1, 2, 3],
  "is_active": false
}
```

#### 导入 Excel/CSV
- **URL**: `/cases/import`
- **Method**: `POST`
- **Form Data**: `file` (Binary)

### 2.3 测试执行 (Runner)

#### 触发测试 (异步)
- **URL**: `/run`
- **Method**: `POST`
- **Body**:
```json
{
  "case_ids": []
}
```
- **Response**:
```json
{
  "message": "Test run started",
  "batch_id": "uuid-string",
  "cases": [...]
}
```

#### 停止测试
- **URL**: `/run/stop`
- **Method**: `POST`
- **Query Param**: `batch_id`

#### 获取活跃批次
- **URL**: `/run/active-batches`
- **Method**: `GET`

#### 获取运行历史 (原始结果)
- **URL**: `/run/history/{batch_id}`
- **Method**: `GET`

#### 实时日志 (WebSocket)
- **URL**: `ws://localhost:8000/run/ws/{batch_id}`

### 2.4 报告管理 (Reports)

#### 获取报告列表
- **URL**: `/reports`
- **Method**: `GET`

#### 获取报告详情
- **URL**: `/reports/{batch_id}/details`
- **Method**: `GET`

#### 导出报告
- **URL**: `/reports/{batch_id}/export`
- **Method**: `GET`

### 2.5 自动生成 (Generator)

#### 生成用例
- **URL**: `/generate/cases`
- **Method**: `POST`
- **Query Param**: `count` (每指标生成数量)

#### 预览元数据
- **URL**: `/generate/preview`
- **Method**: `GET`

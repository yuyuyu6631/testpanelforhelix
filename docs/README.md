# ğŸ¤– API-AutoTest: æ™ºèƒ½æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å° (V5.0)

[![Python Version](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/)
[![Status](https://img.shields.io/badge/status-stable-success.svg)]()
[![License](https://img.shields.io/badge/license-MIT-green.svg)]()

> ä¸€æ¬¾ä¸“ä¸º AI é—®ç­”æœºå™¨äººè®¾è®¡çš„æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°ï¼Œæ”¯æŒç”¨ä¾‹ç®¡ç†ã€è‡ªåŠ¨æ‰§è¡Œä¸æŠ¥å‘Šç”Ÿæˆã€‚
> **V5.0 ç‰ˆæœ¬å¼•å…¥äº†â€œAPI å®šä¹‰ä¸­å¿ƒâ€ï¼Œå®ç°æ¥å£é…ç½®ä¸æ‰§è¡Œé€»è¾‘çš„å½»åº•è§£è€¦ã€‚**

---

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§ (V5.0)

- ğŸ§© **æ¥å£å®šä¹‰ä¸­å¿ƒ (New)** - ç‹¬ç«‹çš„æ¥å£æ¨¡æ¿ç®¡ç†ï¼Œæ”¯æŒå¤šç‰ˆæœ¬/å¤šç¯å¢ƒï¼Œä¸€å¤„ä¿®æ”¹ï¼Œå…¨å±€ç”Ÿæ•ˆã€‚
- ğŸ” **åŠ¨æ€é‰´æƒé…ç½®** - æ”¯æŒ Bearer/ApiKey/Custom ç­‰å¤šç§é‰´æƒæ–¹å¼çš„çµæ´»é…ç½®ã€‚
- âš¡ **å®æ—¶è°ƒè¯•é¢„è§ˆ** - æ¨¡æ¿ç¼–è¾‘æ—¶å³å¯å®æ—¶å‘é€è¯·æ±‚ï¼ŒæŸ¥çœ‹æ¸²æŸ“åçš„ Header/Body åŠå“åº”ç»“æœã€‚
- ğŸ“Š **å¯è§†åŒ–æŠ¥å‘Š** - è‡ªåŠ¨ç”Ÿæˆå¸¦æ ·å¼çš„ Excel æµ‹è¯•æŠ¥å‘Šï¼Œç»“æœä¸€ç›®äº†ç„¶ã€‚
- ğŸš€ **å¼‚æ­¥æ‰¹é‡æ‰§è¡Œ** - åŸºäº FastAPI BackgroundTasks çš„å¼‚æ­¥æ‰§è¡Œå¼•æ“ï¼Œæ”¯æŒ WebSocket å®æ—¶è¿›åº¦æ¨é€ã€‚
- ğŸ”„ **æ•°æ®å¯¼å…¥å¯¼å‡º** - æ”¯æŒ Excel/CSV ç”¨ä¾‹å¯¼å…¥åŠæµ‹è¯•å†å²å¯¼å‡ºã€‚

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```mermaid
graph TD
    A[run_batch_test.py æ‰¹é‡å…¥å£] --> B[AuthManager é‰´æƒ center]
    A --> C[Excel ç”¨ä¾‹åŠ è½½]
    A --> D[ThreadPoolExecutor å¹¶å‘æ‰§è¡Œ]
    D --> E[APIRunner ä¸šåŠ¡è¯·æ±‚]
    E --> F[SSE æµè§£æ/SQLæå–]
    D --> G[Validator ç»“æœæ ¡éªŒ]
    G --> H[Reporter æŠ¥å‘Šç”Ÿæˆ]
    H --> I[data/output/report_result.xlsx]
```

---

## ğŸ“‚ ç›®å½•ç»“æ„

```text
d:\apiautotest\
â”œâ”€â”€ src/                    # æ ¸å¿ƒæºç 
â”‚   â”œâ”€â”€ auth.py             # ç™»å½•é‰´æƒé€»è¾‘ (å« Ticket æ¢ Token)
â”‚   â”œâ”€â”€ api_runner.py       # ä¸šåŠ¡æ¥å£äº¤äº’ (SSE + SQLé€’å½’æå–)
â”‚   â”œâ”€â”€ validator.py        # SQL å‡†ç¡®æ€§åŒ¹é…å¼•æ“
â”‚   â”œâ”€â”€ reporter.py         # Excel æŠ¥å‘Šç”Ÿæˆå·¥å…·
â”‚   â””â”€â”€ config.py           # å…¨å±€ç¯å¢ƒé…ç½®
â”œâ”€â”€ data/                   # æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ input/              # æµ‹è¯•ç”¨ä¾‹ (å¦‚ test_3_cases.xlsx)
â”‚   â””â”€â”€ output/             # æµ‹è¯•æŠ¥å‘Š (Excel)
â”œâ”€â”€ run_batch_test.py       # ã€æ¨èã€‘æ‰¹é‡æµ‹è¯•å¯åŠ¨å…¥å£
â”œâ”€â”€ main.py                 # æ—§ç‰ˆå…¥å£ (ä¿ç•™)
â”œâ”€â”€ requirements.txt        # ä¾èµ–åŒ…æ¸…å•
â””â”€â”€ ä¿®æ”¹è®°å½•_V3.0.md        # ç‰ˆæœ¬æ›´æ–°è¯¦ç»†è®°å½•
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
ç¡®ä¿å·²å®‰è£… Python 3.8+ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ä¾èµ–ï¼š
```bash
pip install -r requirements.txt
```

### 2. å‚æ•°é…ç½®
ç¼–è¾‘ `src/config.py` ç¡®è®¤æµ‹è¯•æ•°æ®è·¯å¾„ï¼š
```python
# æŒ‡å®šæµ‹è¯•ç”¨ä¾‹æ–‡ä»¶
INPUT_FILE = r"D:\apiautotest\data\input\test_3_cases.xlsx"

# ç™»å½•è´¦å·é…ç½®
LOGIN_ACCOUNT = "13439427048"
# ...
```

### 3. è¿è¡Œæ‰¹é‡æµ‹è¯•
ä½¿ç”¨ V3.0 æ–°å¢çš„æ‰¹é‡æµ‹è¯•è„šæœ¬ï¼š
```powershell
python run_batch_test.py
```

### 4. æŸ¥çœ‹æŠ¥å‘Š
æµ‹è¯•ç»“æŸåï¼ŒæŠ¥å‘Šå°†ç”Ÿæˆäºï¼š`D:\apiautotest\data\output\report_result.xlsx`

---

## ğŸ“ V3.0 ç¨³å®šæ€§æ”¹è¿›è¯´æ˜

é’ˆå¯¹ä¹‹å‰ç‰ˆæœ¬å‡ºç°çš„â€œæ— æ³•è·å–æ•°æ®â€ã€â€œé‰´æƒå¤±è´¥â€ç­‰é—®é¢˜ï¼ŒV3.0 è¿›è¡Œäº†ä»¥ä¸‹å…³é”®ä¿®å¤ï¼š

1.  **ç½‘ç»œå±‚ä¼˜åŒ–**ï¼šæ˜¾å¼ç¦ç”¨äº† `requests` çš„ç³»ç»Ÿä»£ç†è®¾ç½®ï¼Œé˜²æ­¢è¯·æ±‚è¢«æœ¬åœ°ä»£ç† (å¦‚ Charles/Fiddler) æ‹¦æˆªå¯¼è‡´è¶…æ—¶ã€‚
2.  **Header ä¿®æ­£**ï¼šä¸¥æ ¼å¯¹é½äº†æµè§ˆå™¨è¡Œä¸ºï¼Œç‰¹åˆ«æ˜¯ `Referer` å­—æ®µè¡¥å……äº† `web-dashboard` è·¯å¾„ï¼Œé˜²æ­¢è¢«æœåŠ¡ç«¯æ‹¦æˆªã€‚
3.  **SQL è§£æå¢å¼º**ï¼šä¸ä»…æ”¯æŒæ ‡å‡†çš„ JSON å­—æ®µæå–ï¼Œè¿˜å¢åŠ äº†å¯¹ **å­—ç¬¦ä¸²å†…åµŒ SQL** (å¦‚ `sql: SELECT...`) çš„è§£ææ”¯æŒï¼Œè§£å†³äº†éƒ¨åˆ†åœºæ™¯ä¸‹æ— æ³•æå– SQL çš„é—®é¢˜ã€‚

---

## ğŸ”— å¸¸è§é—®é¢˜

- **Q: ä¸ºä»€ä¹ˆæç¤º 'no such table'ï¼Ÿ**
  - A: è¿™æ˜¯ä¸šåŠ¡ç³»ç»Ÿçš„æ­£å¸¸è¿”å›ï¼Œè¯´æ˜ SQL è¯­æ³•æ­£ç¡®ä½†è¡¨ä¸å­˜åœ¨ã€‚**åªè¦æå–åˆ°äº† SQLï¼Œæµ‹è¯•æ¡†æ¶å³è§†ä¸ºâ€œæˆåŠŸè·å–â€**ã€‚æ–­è¨€å¤±è´¥æ˜¯å› ä¸ºé¢„æœŸå…³é”®å­—ä¸åŒ¹é…ã€‚
- **Q: ç™»å½•è¶…æ—¶æ€ä¹ˆåŠï¼Ÿ**
  - A: æ£€æŸ¥ç½‘ç»œæ˜¯å¦æ­£å¸¸ï¼Œæˆ–åœ¨ config.py ä¸­å¢åŠ  `LOGIN_TIMEOUT`ã€‚

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ
- **HTTP Client**: [requests](https://requests.readthedocs.io/)
- **Concurrency**: [concurrent.futures](https://docs.python.org/3/library/concurrent.futures.html)
- **Data Engine**: [pandas](https://pandas.pydata.org/)
